define(["jquery"],function(a){function b(b,e){this.element=b,this.settings=a.extend({},d,e),this._defaults=d,this._name=c,this.init(b)}var c="jTinder",d={onDislike:null,onLike:null,animationRevertSpeed:200,animationSpeed:400,threshold:1,likeSelector:".like",dislikeSelector:".dislike",actionsSelector:'[data-region="cardactions"]',commentsRegion:".card-comments .card-comment-item"},e=null,f=null,g=null,h=0,i=0,j=!1,k=0,l=0,m=0,n=0,o=0,p=0,q=0;b.prototype={init:function(b){e=a(">ul",b),f=a(">ul>li",b),o=e.width(),p=f.length,q=f.length-1;var c=a(f[q]).attr("data-card-id");g=this,a(g.settings.actionsSelector).attr("data-current-card",c),a(b).bind("touchstart mousedown",this.handler),a(b).bind("touchmove mousemove",this.handler),a(b).bind("touchend mouseup",this.handler)},showPane:function(a){f.eq(q).hide(),q=a},next:function(){a(g.settings.commentsRegion).each(function(b,c){a(c).addClass("hidden")});var b=a(f[q-1]).attr("data-card-id");return a(g.settings.actionsSelector).attr("data-current-card",b),this.showPane(q-1)},dislike:function(){f.eq(q).animate({transform:"translate(-"+o+"px,"+o*-1.5+"px) rotate(-60deg)"},g.settings.animationSpeed,function(){g.settings.onDislike&&g.settings.onDislike(f.eq(q)),g.next()})},like:function(){f.eq(q).animate({transform:"translate("+o+"px,"+o*-1.5+"px) rotate(60deg)"},g.settings.animationSpeed,function(){g.settings.onLike&&g.settings.onLike(f.eq(q)),g.next()})},handler:function(a){switch(a.preventDefault(),a.type){case"touchstart":j===!1&&(j=!0,h=a.originalEvent.touches[0].pageX,i=a.originalEvent.touches[0].pageY);case"mousedown":j===!1&&(j=!0,h=a.pageX,i=a.pageY);case"mousemove":case"touchmove":if(j===!0){var b="undefined"==typeof a.pageX?a.originalEvent.touches[0].pageX:a.pageX,c="undefined"==typeof a.pageY?a.originalEvent.touches[0].pageY:a.pageY,d=parseInt(b)-parseInt(h),e=parseInt(c)-parseInt(i),r=100/o*d/p;k=d+m,l=e+n,f.eq(q).css("transform","translate("+k+"px,"+l+"px) rotate("+r/2+"deg)");var s=Math.abs(d)/g.settings.threshold/100+.2;s>1&&(s=1),k>=0?(f.eq(q).find(g.settings.likeSelector).css("opacity",s),f.eq(q).find(g.settings.dislikeSelector).css("opacity",0)):k<0&&(f.eq(q).find(g.settings.dislikeSelector).css("opacity",s),f.eq(q).find(g.settings.likeSelector).css("opacity",0))}break;case"mouseup":case"touchend":j=!1;var b="undefined"==typeof a.pageX?a.originalEvent.changedTouches[0].pageX:a.pageX,c="undefined"==typeof a.pageY?a.originalEvent.changedTouches[0].pageY:a.pageY,d=parseInt(b)-parseInt(h),e=parseInt(c)-parseInt(i);k=d+m,l=e+n;var s=Math.abs(Math.abs(d)/g.settings.threshold/100+.2);s>=1?k>0?f.eq(q).animate({transform:"translate("+o+"px,"+(l+o)+"px) rotate(60deg)"},g.settings.animationSpeed,function(){g.settings.onLike&&g.settings.onLike(f.eq(q)),g.next()}):f.eq(q).animate({transform:"translate(-"+o+"px,"+(l+o)+"px) rotate(-60deg)"},g.settings.animationSpeed,function(){g.settings.onDislike&&g.settings.onDislike(f.eq(q)),g.next()}):(m=0,n=0,f.eq(q).animate({transform:"translate(0px,0px) rotate(0deg)"},g.settings.animationRevertSpeed),f.eq(q).find(g.settings.likeSelector).animate({opacity:0},g.settings.animationRevertSpeed),f.eq(q).find(g.settings.dislikeSelector).animate({opacity:0},g.settings.animationRevertSpeed))}}},a.fn[c]=function(d){return this.each(function(){a.data(this,"plugin_"+c)?a.isFunction(b.prototype[d])&&a.data(this,"plugin_"+c)[d]():a.data(this,"plugin_"+c,new b(this,d))}),this}});