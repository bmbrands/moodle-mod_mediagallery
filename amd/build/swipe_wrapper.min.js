define(["jquery","core/custom_interaction_events","core/notification","core/ajax","mod_mediagallery/transform","mod_mediagallery/tinder"],function(a,b,c,d,e,f){var g={VIEW_COMMENTS:'[data-action="view-comments"]',LIKE:'[data-action="like"]',DISLIKE:'[data-action="dislike"]',VIEW_INFO:'[data-action="info"]',CLOSE_INFO:'[data-action="close-info"]',ACTION_CONTAINER:'[data-region="cardactions"]',INFO_CONTAINER:'[data-region="card-info"]',CARD_IMAGE:'[data-region="card-image"]',CARD_VIDEO:'[data-region="card-video"]'},h={IMAGE:1,VIDEO:2,TEXT:3},i=function(a,b){var e={itemid:a,like:b},f={methodname:"mod_mediagallery_like",args:e},g=d.call([f])[0];return g.fail(c.exception),g},j=function(a){var b=a.find(g.ACTION_CONTAINER);return b.attr("data-current-card")},k=function(a,b){if(b){var c=a.find("[data-card-id="+b+"]");return c}},l=function(a){var b=a.find(g.INFO_CONTAINER),c=b.attr("data-status");"closed"==c?(b.css("top","0"),b.attr("data-status","open")):(b.css("top","-420px"),b.attr("data-status","closed"))},m=function(c){b.define(c,[b.events.activate]),c.on(b.events.activate,g.VIEW_COMMENTS,function(b,d){var e=j(c),f=a("#comment-area"+e);f.find(".comment-ctrl").css("display","block"),f.removeClass("hidden"),d.originalEvent.preventDefault()}),c.on(b.events.activate,g.VIEW_INFO,function(a,b){var d=j(c),e=k(c,d);l(e),b.originalEvent.preventDefault()}),c.on(b.events.activate,g.CLOSE_INFO,function(a,b){var d=j(c),e=k(c,d);l(e),b.originalEvent.preventDefault()}),c.on(b.events.activate,g.LIKE,function(b,c){a(b.target).closest(g.LIKE);a("#tinderslide").jTinder("like"),c.originalEvent.preventDefault()}),c.on(b.events.activate,g.DISLIKE,function(b,c){a(b.target).closest(g.DISLIKE);a("#tinderslide").jTinder("dislike"),c.originalEvent.preventDefault()})},n=function(b,c){var d=k(b,c);if(d.length){var e=d.attr("data-card-type");if(e==h.VIDEO){var f=d.find("iframe");if(f.length){var i=f.attr("src");f.attr("src",""),f.attr("src",i)}}var j=d.attr("data-preload");if(d.attr("data-last")&&(a(g.ACTION_CONTAINER).addClass("disabled"),console.log("this was the last card")),j){if(preloadCard=k(b,j),preloadCard.attr("data-card-type")==h.IMAGE){var l=preloadCard.attr("data-card-image");preloadCard.find(g.CARD_IMAGE).attr("style","background-image: url("+l+")")}if(preloadCard.attr("data-card-type")==h.VIDEO){var i=preloadCard.attr("data-card-video");preloadCard.find(g.CARD_VIDEO).attr("src",i)}}}},o=function(b){var b=a(b);a("#tinderslide").jTinder({onDislike:function(a){var c=j(b);i(c,!1),n(b,c)},onLike:function(a){var c=j(b);i(c,!0),n(b,c)},animationRevertSpeed:200,animationSpeed:400,threshold:1,likeSelector:".like",dislikeSelector:".dislike"}),m(b)};return{init:o}});