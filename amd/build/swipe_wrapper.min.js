define(["jquery","core/custom_interaction_events","core/notification","core/ajax","mod_mediagallery/transform","mod_mediagallery/tinder","mod_mediagallery/textFit"],function(a,b,c,d,e,f,g){var h={WRAPPER:'[data-region="swipe-wrapper"]',LIKE:'[data-action="like"]',DISLIKE:'[data-action="dislike"]',VIEW_INFO:'[data-action="info"]',CLOSE_INFO:'[data-action="close-info"]',ACTION_CONTAINER:'[data-region="cardactions"]',INFO_CONTAINER:'[data-region="card-info"]',CARD_IMAGE:'[data-region="card-image"]',CARD_VIDEO:'[data-region="card-video"]',FEEDBACK_CONTAINER:'[data-region="feedback-container"]',FEEDBACK_INPUT:'[data-region="feedback-input"]',FEEDBACK_SEND:'[data-action="send-feedback"]',FEEDBACK_THANKS:'[data-region="feedback-thanks"]',FEEDBACK_TEXT:'[data-region="feedback-text"]'},i={IMAGE:1,VIDEO:2,TEXT:3},j=function(a,b){var e={itemid:a,like:b},f={methodname:"mod_mediagallery_like",args:e},g=d.call([f])[0];return g.fail(c.exception),g},k=function(a,b){var e={galleryid:a,feedback:b},f={methodname:"mod_mediagallery_feedback",args:e},g=d.call([f])[0];return g.fail(c.exception),g},l=function(a){var b=a.find(h.ACTION_CONTAINER);return b.attr("data-current-card")},m=function(a,b){if(b){var c=a.find("[data-card-id="+b+"]");return c}},n=function(a){var b=a.find(h.INFO_CONTAINER),c=b.attr("data-status");"closed"==c?(b.css("top","0"),b.attr("data-status","open")):(b.css("top","-420px"),b.attr("data-status","closed"))},o=function(c){b.define(c,[b.events.activate]),c.on(b.events.activate,h.VIEW_INFO,function(a,b){var d=l(c),e=m(c,d);n(e),b.originalEvent.preventDefault()}),c.on(b.events.activate,h.CLOSE_INFO,function(a,b){var d=l(c),e=m(c,d);n(e),b.originalEvent.preventDefault()}),c.on(b.events.activate,h.LIKE,function(b,c){a(b.target).closest(h.LIKE);a("#tinderslide").jTinder("like"),c.originalEvent.preventDefault()}),c.on(b.events.activate,h.DISLIKE,function(b,c){a(b.target).closest(h.DISLIKE);a("#tinderslide").jTinder("dislike"),c.originalEvent.preventDefault()}),c.on(b.events.activate,h.FEEDBACK_SEND,function(a,b){var d=c.find(h.FEEDBACK_CONTAINER),e=d.find(h.FEEDBACK_INPUT),f=d.find(h.FEEDBACK_TEXT),g=d.find(h.FEEDBACK_THANKS),i=d.attr("data-galleryid"),j=f.val();k(i,j).then(function(){e.addClass("hidden"),g.removeClass("hidden")}),b.originalEvent.preventDefault()})},p=function(a,b){var c=m(a,b);if(c.length){var d=c.attr("data-card-type");if(d==i.VIDEO){var e=c.find("iframe");if(e.length){var f=e.attr("src");e.attr("src",""),e.attr("src",f)}}var g=c.attr("data-preload");if(c.attr("data-last")&&(a.find(h.ACTION_CONTAINER).addClass("hidden"),a.find(h.FEEDBACK_CONTAINER).removeClass("hidden"),a.find(h.WRAPPER).addClass("hidden")),g){if(preloadCard=m(a,g),preloadCard.attr("data-card-type")==i.IMAGE){var j=preloadCard.attr("data-card-image");preloadCard.find(h.CARD_IMAGE).attr("style","background-image: url("+j+")")}if(preloadCard.attr("data-card-type")==i.VIDEO){var f=preloadCard.attr("data-card-video");preloadCard.find(h.CARD_VIDEO).attr("src",f)}}}},q=function(b){var b=a(b);g(document.getElementsByClassName("innertext"),{multiLine:!0}),a("#tinderslide").jTinder({onDislike:function(a){var c=l(b);j(c,!1),p(b,c)},onLike:function(a){var c=l(b);j(c,!0),p(b,c)},animationRevertSpeed:200,animationSpeed:400,threshold:1,likeSelector:".like",dislikeSelector:".dislike"}),o(b)};return{init:q}});