define(["jquery","core/custom_interaction_events","core/notification","core/ajax","mod_mediagallery/transform","mod_mediagallery/tinder","mod_mediagallery/textFit"],function(a,b,c,d,e,f,g){var h={VIEW_COMMENTS:'[data-action="view-comments"]',LIKE:'[data-action="like"]',DISLIKE:'[data-action="dislike"]',VIEW_INFO:'[data-action="info"]',CLOSE_INFO:'[data-action="close-info"]',ACTION_CONTAINER:'[data-region="cardactions"]',INFO_CONTAINER:'[data-region="card-info"]',CARD_IMAGE:'[data-region="card-image"]',CARD_VIDEO:'[data-region="card-video"]'},i={IMAGE:1,VIDEO:2,TEXT:3},j=function(a,b){var e={itemid:a,like:b},f={methodname:"mod_mediagallery_like",args:e},g=d.call([f])[0];return g.fail(c.exception),g},k=function(a){var b=a.find(h.ACTION_CONTAINER);return b.attr("data-current-card")},l=function(a,b){if(b){var c=a.find("[data-card-id="+b+"]");return c}},m=function(a){var b=a.find(h.INFO_CONTAINER),c=b.attr("data-status");"closed"==c?(b.css("top","0"),b.attr("data-status","open")):(b.css("top","-420px"),b.attr("data-status","closed"))},n=function(c){b.define(c,[b.events.activate]),c.on(b.events.activate,h.VIEW_COMMENTS,function(b,d){var e=k(c),f=a("#comment-area"+e);f.find(".comment-ctrl").css("display","block"),f.removeClass("hidden"),d.originalEvent.preventDefault()}),c.on(b.events.activate,h.VIEW_INFO,function(a,b){var d=k(c),e=l(c,d);m(e),b.originalEvent.preventDefault()}),c.on(b.events.activate,h.CLOSE_INFO,function(a,b){var d=k(c),e=l(c,d);m(e),b.originalEvent.preventDefault()}),c.on(b.events.activate,h.LIKE,function(b,c){a(b.target).closest(h.LIKE);a("#tinderslide").jTinder("like"),c.originalEvent.preventDefault()}),c.on(b.events.activate,h.DISLIKE,function(b,c){a(b.target).closest(h.DISLIKE);a("#tinderslide").jTinder("dislike"),c.originalEvent.preventDefault()})},o=function(b,c){var d=l(b,c);if(d.length){var e=d.attr("data-card-type");if(e==i.VIDEO){var f=d.find("iframe");if(f.length){var g=f.attr("src");f.attr("src",""),f.attr("src",g)}}var j=d.attr("data-preload");if(d.attr("data-last")&&a(h.ACTION_CONTAINER).addClass("disabled"),j){if(preloadCard=l(b,j),preloadCard.attr("data-card-type")==i.IMAGE){var k=preloadCard.attr("data-card-image");preloadCard.find(h.CARD_IMAGE).attr("style","background-image: url("+k+")")}if(preloadCard.attr("data-card-type")==i.VIDEO){var g=preloadCard.attr("data-card-video");preloadCard.find(h.CARD_VIDEO).attr("src",g)}}}},p=function(b){var b=a(b);g(document.getElementsByClassName("innertext"),{multiLine:!0}),a("#tinderslide").jTinder({onDislike:function(a){var c=k(b);j(c,!1),o(b,c)},onLike:function(a){var c=k(b);j(c,!0),o(b,c)},animationRevertSpeed:200,animationSpeed:400,threshold:1,likeSelector:".like",dislikeSelector:".dislike"}),n(b)};return{init:p}});